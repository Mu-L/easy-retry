import{_ as F}from"./table-header-operation.vue_vue_type_script_setup_true_lang-ntuddL0e.js";import{bj as U,d as V,U as P,V as W,o as B,c as M,w as r,f as a,h as e,$ as t,n as A,p as S,bk as K,g as y,t as _,a4 as T,cw as j,cv as O,N as z,bi as E,bh as G,s as H,a8 as J,b as Q,a9 as I,B as C,I as X,aa as Y}from"./index-DQvTTbM-.js";import{_ as Z,u as ee,a as te,N as ae}from"./table-BY-eM7wn.js";import{_ as le}from"./search-form.vue_vue_type_script_setup_true_lang-gb65EZBS.js";import{_ as oe}from"./select-group.vue_vue_type_script_setup_true_lang-BFflBQVF.js";import{_ as ne}from"./select-scene.vue_vue_type_script_setup_true_lang-OZknE6JY.js";import{_ as re}from"./detail-drawer-CbMhCQld.js";import{_ as se,a as ie}from"./log-kdQNaTzi.js";import{_ as ue,a as pe}from"./DescriptionsItem-Bd4R5YlG.js";import{b as de}from"./Grid-CSTnYjse.js";import"./Space-B5Upi9VN.js";import"./form-Bu4MD_Ly.js";import"./round-search-DSNvd4Y0.js";import"./group-DKztxFm0.js";import"./retry-scene-BU9f1qWu.js";import"./close-fullscreen-rounded-BQkrG2tL.js";import"./CollapseItem-Cc60zQbl.js";function me(u){return U({url:"/retry-task-log/list",method:"get",params:u})}function ce(u){return U({url:`/retry-task-log/${u}`,method:"get"})}function ge(u){return U({url:`/retry-task-log/${u}`,method:"delete"})}function fe(u){return U({url:"/retry-task-log/ids",method:"delete",data:u})}const ye=V({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(u,{emit:w}){const v=w,s=W(u,"model");function h(){v("reset")}function D(){v("search")}return(N,p)=>{const c=Z,b=A,L=le;return B(),M(L,{model:s.value,onSearch:D,onReset:h},{default:r(()=>[a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[a(oe,{modelValue:s.value.groupName,"onUpdate:modelValue":p[0]||(p[0]=d=>s.value.groupName=d)},null,8,["modelValue"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:r(()=>[a(ne,{value:s.value.sceneName,"onUpdate:value":p[1]||(p[1]=d=>s.value.sceneName=d),"group-name":s.value.groupName},null,8,["value","group-name"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:r(()=>[a(b,{value:s.value.uniqueId,"onUpdate:value":p[2]||(p[2]=d=>s.value.uniqueId=d),placeholder:e(t)("page.retryLog.form.UniqueId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:r(()=>[a(b,{value:s.value.idempotentId,"onUpdate:value":p[3]||(p[3]=d=>s.value.idempotentId=d),placeholder:e(t)("page.retryLog.form.idempotentId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:r(()=>[a(b,{value:s.value.bizNo,"onUpdate:value":p[4]||(p[4]=d=>s.value.bizNo=d),placeholder:e(t)("page.retryLog.form.bizNo")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),_e=V({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:P({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(u){const w=u,v=W(u,"visible"),s=S([]),h=S(),D=new AbortController,N=S(!1);let p="0",c=0;async function b(){const{data:i,error:f}=await ie({groupName:w.rowData.groupName,uniqueId:w.rowData.uniqueId,startId:p,fromIndex:c,size:50});f||(N.value=i.finished,p=i.nextStartId,c=i.fromIndex,i.message&&(s.value.push(...i.message),s.value.sort((g,k)=>Number.parseInt(g.time_stamp,10)-Number.parseInt(k.time_stamp,10))),N.value||(clearTimeout(h.value),h.value=setTimeout(b,1e3)))}const L=async i=>{i===1&&s.value.length===0&&await b()},d=()=>{N.value=!0,D.abort(),clearTimeout(h.value),h.value=void 0};return K(()=>{d()}),(i,f)=>{const g=ue,k=z,x=pe,n=E,o=se,R=G,q=re;return B(),M(q,{modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=l=>v.value=l),title:e(t)("page.retryLog.detail"),width:["50%","90%"]},{default:r(()=>[a(R,{type:"segment",animated:"","onUpdate:value":L},{default:r(()=>[a(n,{name:0,tab:e(t)("page.log.info")},{default:r(()=>[a(x,{"label-placement":"top",bordered:"",column:2},{default:r(()=>[a(g,{label:e(t)("page.retryLog.UniqueId"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.uniqueId),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.groupName"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.sceneName"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.sceneName),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.retryStatus"),span:1},{default:r(()=>{var l;return[a(k,{type:e(T)((l=i.rowData)==null?void 0:l.retryStatus)},{default:r(()=>{var m;return[y(_(e(t)(e(j)[(m=i.rowData)==null?void 0:m.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.taskType"),span:1},{default:r(()=>{var l;return[a(k,{type:e(T)((l=i.rowData)==null?void 0:l.taskType)},{default:r(()=>{var m;return[y(_(e(t)(e(O)[(m=i.rowData)==null?void 0:m.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.bizNo"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.bizNo),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryLog.idempotentId"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.idempotentId),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryTask.executorName"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.executorName),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.retryTask.argsStr"),span:2},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.argsStr),1)]}),_:1},8,["label"]),a(g,{label:e(t)("common.createDt")},{default:r(()=>{var l;return[y(_((l=i.rowData)==null?void 0:l.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),a(n,{name:1,tab:e(t)("page.log.title"),"display-directive":"if"},{default:r(()=>[a(o,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=l=>s.value=l),drawer:!1},null,8,["modelValue"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function $(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!Y(u)}const Be=V({name:"retry_log",__name:"index",setup(u){const w=H(),v=S(),{bool:s,setTrue:h}=J(!1),{columns:D,columnChecks:N,data:p,getData:c,loading:b,mobilePagination:L,searchParams:d,resetSearchParams:i}=ee({apiFn:me,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null},columns:()=>[{type:"selection",align:"center",width:48,disabled:n=>n.retryStatus!==1},{key:"index",title:t("common.index"),align:"center",width:64},{key:"uniqueId",title:t("page.retryLog.UniqueId"),align:"left",minWidth:120,render:n=>{async function o(){await x(n),h()}return a(C,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[n.uniqueId]})}},{key:"groupName",title:t("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:t("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:t("page.retryLog.retryStatus"),align:"left",minWidth:120,render:n=>{if(n.retryStatus===null)return null;const o=t(j[n.retryStatus]);return a(z,{type:T(n.retryStatus)},$(o)?o:{default:()=>[o]})}},{key:"taskType",title:t("page.retryLog.taskType"),align:"left",minWidth:120,render:n=>{if(n.taskType===null)return null;const o=t(O[n.taskType]);return a(z,{type:T(n.taskType)},$(o)?o:{default:()=>[o]})}},{key:"idempotentId",title:t("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:t("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:t("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:n=>a("div",{class:"flex-center gap-8px"},[n.retryStatus===1?a(ae,{onPositiveClick:()=>k(n.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let o;return a(C,{type:"error",ghost:!0,size:"small"},$(o=t("common.delete"))?o:{default:()=>[o]})}}):""])}]}),{checkedRowKeys:f}=te(p,c);async function g(){var o;const{error:n}=await fe(f.value);n||((o=window.$message)==null||o.success(t("common.deleteSuccess")),c())}async function k(n){var o;await ge(n),(o=window.$message)==null||o.success(t("common.deleteSuccess")),c()}async function x(n){const o=await ce(n.id);v.value=o.data||null}return(n,o)=>{const R=F,q=de,l=X;return B(),Q("div",be,[a(ye,{model:e(d),"onUpdate:model":o[0]||(o[0]=m=>I(d)?d.value=m:null),onReset:e(i),onSearch:e(c)},null,8,["model","onReset","onSearch"]),a(l,{title:e(t)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[a(R,{columns:e(N),"onUpdate:columns":o[1]||(o[1]=m=>I(N)?N.value=m:null),"disabled-delete":e(f).length===0,loading:e(b),onDelete:g,onRefresh:e(c)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:r(()=>[a(q,{"checked-row-keys":e(f),"onUpdate:checkedRowKeys":o[2]||(o[2]=m=>I(f)?f.value=m:null),columns:e(D),data:e(p),"flex-height":!e(w).isMobile,"scroll-x":962,loading:e(b),remote:"","row-key":m=>m.id,pagination:e(L),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(_e,{visible:e(s),"onUpdate:visible":o[3]||(o[3]=m=>I(s)?s.value=m:null),"row-data":v.value},null,8,["visible","row-data"])])}}});export{Be as default};
