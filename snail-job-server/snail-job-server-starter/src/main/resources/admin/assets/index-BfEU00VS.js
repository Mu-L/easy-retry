import{c as Ie,d as De,_ as Re,u as $e,a as Ue,N as pe,b as Ve}from"./table-Bdl3-G-Y.js";import{d as Ce,_ as Oe,a as Ke}from"./download-Cm66Rkpl.js";import{d as C,p as z,o as S,c as D,h as e,$ as t,Y,bo as Ae,a6 as X,bp as Fe,bq as Je,br as Me,U as Q,V as le,s as fe,W as ae,b as oe,w as o,f as a,g as T,t as v,bs as Be,S as Pe,bt as ye,O as Te,n as de,r as ge,a as ze,Q as me,R as be,bu as ve,a2 as Ge,a3 as Ee,B as P,I as ke,a8 as L,bv as je,bw as qe,bx as Le,bn as He,by as he,bz as Ne,N as te,u as We,ac as Qe,ad as W,M as ie,ae as Ye}from"./index-CHgAHQIl.js";import{b as Xe,c as Ze,d as ea,e as aa,g as ta,h as oa}from"./job-ClIVIZwj.js";import{_ as la}from"./status-switch.vue_vue_type_script_setup_true_lang-DFxhp7sV.js";import{u as ra}from"./auth-uwVlWSMM.js";import{_ as Se}from"./select-group.vue_vue_type_script_setup_true_lang-fZ9yr9an.js";import{u as na,a as sa}from"./form-BuwwOwyC.js";import{_ as xe}from"./operate-drawer-3XJn0MkC.js";import{_ as we,a as ua}from"./route-key.vue_vue_type_script_setup_true_lang-BiAt3t-S.js";import{_ as _e}from"./code-mirror.vue_vue_type_script_setup_true_lang-Bu9xLnRf.js";import{_ as pa,a as ia}from"./FormItem-B3tfy17D.js";import{_ as ma}from"./Space-CeVCCXQI.js";import{c as da,d as ca,_ as ga}from"./Grid-DHGKk79k.js";import{_ as ba}from"./search-form.vue_vue_type_script_setup_true_lang-BfZ4by1v.js";import{_ as _a,a as fa}from"./DescriptionsItem-sCQ7QkHp.js";import"./Progress-Ba5RQgAV.js";import"./group-BUALrrKR.js";import"./close-fullscreen-rounded-DtEdfPev.js";import"./index-DBxP5q3t.js";import"./round-search-KK91k1IY.js";const ya=C({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup(h,{emit:y}){const n=y,f=z(),s=c=>{n("update:value",c)};return(c,g)=>{const _=X;return S(),D(_,{value:f.value,"onUpdate:value":[g[0]||(g[0]=l=>f.value=l),s],placeholder:e(t)("common.triggerType.form"),options:e(Y)(e(Ae)),clearable:""},null,8,["value","placeholder","options"])}}}),Ta=C({name:"BlockStrategy",__name:"block-strategy",emits:["update:value"],setup(h,{emit:y}){const n=z(),f=y,s=c=>{f("update:value",c)};return(c,g)=>{const _=X;return S(),D(_,{value:n.value,"onUpdate:value":[g[0]||(g[0]=l=>n.value=l),s],placeholder:e(t)("common.blockStrategy.form"),options:e(Y)(e(Fe)),clearable:""},null,8,["value","placeholder","options"])}}}),va=C({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup(h,{emit:y}){const n=z(),f=y,s=c=>{f("update:value",c)};return(c,g)=>{const _=X;return S(),D(_,{value:n.value,"onUpdate:value":[g[0]||(g[0]=l=>n.value=l),s],placeholder:e(t)("common.executorType.form"),options:e(Y)(e(Je)),clearable:""},null,8,["value","placeholder","options"])}}}),ka=C({name:"TaskType",__name:"task-type",emits:["update:value"],setup(h,{emit:y}){const n=y,f=z(),s=c=>{n("update:value",c)};return(c,g)=>{const _=X;return S(),D(_,{value:f.value,"onUpdate:value":[g[0]||(g[0]=l=>f.value=l),s],placeholder:e(t)("common.routeKey.routeForm"),options:e(Y)(e(Me)),clearable:""},null,8,["value","placeholder","options"])}}}),ja=C({name:"JobTriggerInterval",__name:"job-trigger-interval",props:Q({triggerType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const y=le(h,"modelValue"),n=h,f=fe(),s=z(n.triggerType===2?Number(y.value):60),c=z(n.triggerType===3?y.value:"* * * * * ?");return ae(s,g=>{n.triggerType===2&&(y.value=`${g}`)},{immediate:!0}),ae(c,g=>{n.triggerType===3&&(y.value=g)},{immediate:!0}),ae(()=>n.triggerType,g=>{g===2?y.value=`${s.value}`:g===3?y.value=c.value:y.value="*"},{immediate:!0}),(g,_)=>{const l=ye,u=we,R=Te,r=de;return S(),oe("div",null,[g.triggerType===2?(S(),D(R,{key:0},{default:o(()=>[a(l,{value:s.value,"onUpdate:value":_[0]||(_[0]=I=>s.value=I),placeholder:g.$t("page.jobTask.form.triggerInterval")},null,8,["value","placeholder"]),a(u,null,{default:o(()=>[T(v(g.$t("common.second")),1)]),_:1})]),_:1})):g.triggerType===3?(S(),D(e(Be),{key:1,modelValue:c.value,"onUpdate:modelValue":_[1]||(_[1]=I=>c.value=I),placeholder:g.$t("page.jobTask.form.triggerInterval_CRON"),lang:e(f).locale},null,8,["modelValue","placeholder","lang"])):g.triggerType===99?(S(),D(r,{key:2,disabled:""})):Pe("",!0)])}}}),ha=C({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(h,{emit:y}){const n=h,f=y,s=le(h,"visible"),c=ge({args:[{arg:""}]}),{formRef:g,validate:_,restoreValidation:l}=na(),{defaultRequiredRule:u}=sa(),R=ze(()=>({add:t("page.jobTask.addJobTask"),edit:t("page.jobTask.editJobTask")})[n.operateType]),r=ge(I());function I(){return{groupName:"",jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:1,executorType:1,triggerType:2,executorInfo:"",triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:""}}const O={groupName:u,jobName:u,argsType:u,jobStatus:u,routeKey:u,executorType:u,executorInfo:u,triggerType:u,triggerInterval:u,blockStrategy:u,executorTimeout:u,maxRetryTimes:u,retryInterval:u,taskType:u,parallelNum:u};function re(){if(n.operateType==="add"){Object.assign(r,I());return}n.operateType==="edit"&&n.rowData&&(Object.assign(r,n.rowData),r.taskType===3&&r.argsStr&&Object.assign(c,{args:JSON.parse(r.argsStr).map(N=>({arg:N}))}))}function G(){s.value=!1}async function Z(){var N,i;if(await _(),n.operateType==="add"){const{groupName:V,jobName:k,argsType:F,jobStatus:J,routeKey:K,executorType:M,executorInfo:m,triggerType:d,triggerInterval:b,blockStrategy:j,executorTimeout:w,maxRetryTimes:$,retryInterval:U,taskType:x,parallelNum:A,description:E}=r,{error:q}=await Xe({groupName:V,jobName:k,argsStr:ee(),argsType:F,jobStatus:J,routeKey:K,executorType:M,executorInfo:m,triggerType:d,triggerInterval:b,blockStrategy:j,executorTimeout:w,maxRetryTimes:$,retryInterval:U,taskType:x,parallelNum:A,description:E});if(q)return;(N=window.$message)==null||N.success(t("common.addSuccess"))}if(n.operateType==="edit"){const{id:V,groupName:k,jobName:F,argsType:J,jobStatus:K,routeKey:M,executorType:m,executorInfo:d,triggerType:b,triggerInterval:j,blockStrategy:w,executorTimeout:$,maxRetryTimes:U,retryInterval:x,taskType:A,parallelNum:E,description:q}=r,{error:ue}=await Ze({id:V,groupName:k,jobName:F,argsStr:ee(),argsType:J,jobStatus:K,routeKey:M,executorType:m,executorInfo:d,triggerType:b,triggerInterval:j,blockStrategy:w,executorTimeout:$,maxRetryTimes:U,retryInterval:x,taskType:A,parallelNum:E,description:q});if(ue)return;(i=window.$message)==null||i.success(t("common.updateSuccess"))}G(),f("submitted")}function ee(){return r.taskType===3&&c.args?JSON.stringify(c.args.map(N=>N.arg)):r.argsStr}const ne=N=>{c.args.splice(N,1)},se=()=>{c.args.push({arg:""})};return ae(s,()=>{s.value&&(re(),l())}),(N,i)=>{const V=de,k=pa,F=Se,J=Ge,K=ma,M=Ee,m=Ie,d=P,b=De,j=ke,w=da,$=Ta,U=ca,x=ya,A=ye,E=we,q=Te,ue=ia;return S(),D(xe,{modelValue:s.value,"onUpdate:modelValue":i[16]||(i[16]=p=>s.value=p),title:R.value,"min-size":480,onHandleSubmit:Z},{footer:o(()=>[a(K,{size:16},{default:o(()=>[a(d,{onClick:G},{default:o(()=>[T(v(e(t)("common.cancel")),1)]),_:1}),a(d,{type:"primary",onClick:Z},{default:o(()=>[T(v(e(t)("common.save")),1)]),_:1})]),_:1})]),default:o(()=>[a(ue,{ref_key:"formRef",ref:g,model:r,rules:O},{default:o(()=>[a(k,{label:e(t)("page.jobTask.jobName"),path:"jobName"},{default:o(()=>[a(V,{value:r.jobName,"onUpdate:value":i[0]||(i[0]=p=>r.jobName=p),maxlength:64,"show-count":"",placeholder:e(t)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.groupName"),path:"groupName"},{default:o(()=>[a(F,{value:r.groupName,"onUpdate:value":i[1]||(i[1]=p=>r.groupName=p)},null,8,["value"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.jobStatus"),path:"jobStatus"},{default:o(()=>[a(M,{value:r.jobStatus,"onUpdate:value":i[2]||(i[2]=p=>r.jobStatus=p),name:"jobStatus"},{default:o(()=>[a(K,null,{default:o(()=>[(S(!0),oe(me,null,be(e(ve),p=>(S(),D(J,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.executorType"),path:"executorType"},{default:o(()=>[a(va,{value:r.executorType,"onUpdate:value":i[3]||(i[3]=p=>r.executorType=p)},null,8,["value"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.executorInfo"),path:"executorInfo"},{default:o(()=>[a(V,{value:r.executorInfo,"onUpdate:value":i[4]||(i[4]=p=>r.executorInfo=p),placeholder:e(t)("page.jobTask.form.executorInfo")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.taskType"),path:"taskType"},{default:o(()=>[a(ka,{value:r.taskType,"onUpdate:value":i[5]||(i[5]=p=>r.taskType=p),placeholder:e(t)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.argsStr"),path:"argsStr",rule:r.taskType===3?e(u):void 0},{default:o(()=>[r.taskType===3?(S(),D(j,{key:0,class:"flex-col"},{default:o(()=>[(S(!0),oe(me,null,be(c.args,(p,H)=>(S(),D(k,{key:H,label:`分片参数 ${H+1}`,path:`args[${H}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${e(t)("page.jobTask.form.argsStr")} ${H+1}`,trigger:["input","blur"],validator(){return!!p.arg}}},{default:o(()=>[a(_e,{modelValue:p.arg,"onUpdate:modelValue":ce=>p.arg=ce,lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(d,{class:"ml-12px",type:"error",dashed:"",onClick:ce=>ne(H)},{default:o(()=>[a(m,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),a(d,{block:"",dashed:"","attr-type":"button",onClick:se},{default:o(()=>[a(b,{class:"text-icon"})]),_:1})]),_:1})):(S(),D(_e,{key:1,modelValue:r.argsStr,"onUpdate:modelValue":i[6]||(i[6]=p=>r.argsStr=p),lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))]),_:1},8,["label","rule"]),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.routeKey"),path:"routeKey"},{default:o(()=>[a(ua,{value:r.routeKey,"onUpdate:value":i[7]||(i[7]=p=>r.routeKey=p),"task-type":r.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:o(()=>[a($,{value:r.blockStrategy,"onUpdate:value":i[8]||(i[8]=p=>r.blockStrategy=p)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.triggerType"),path:"triggerType"},{default:o(()=>[a(x,{value:r.triggerType,"onUpdate:value":i[9]||(i[9]=p=>r.triggerType=p),placeholder:e(t)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:o(()=>[a(ja,{modelValue:r.triggerInterval,"onUpdate:modelValue":i[10]||(i[10]=p=>r.triggerInterval=p),"trigger-type":r.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:o(()=>[a(q,null,{default:o(()=>[a(A,{value:r.executorTimeout,"onUpdate:value":i[11]||(i[11]=p=>r.executorTimeout=p),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),a(E,null,{default:o(()=>[T(v(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:o(()=>[a(A,{value:r.maxRetryTimes,"onUpdate:value":i[12]||(i[12]=p=>r.maxRetryTimes=p),min:1,max:999,placeholder:e(t)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.retryInterval"),path:"retryInterval"},{default:o(()=>[a(q,null,{default:o(()=>[a(A,{value:r.retryInterval,"onUpdate:value":i[13]||(i[13]=p=>r.retryInterval=p),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),a(E,null,{default:o(()=>[T(v(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(w,null,{default:o(()=>[a(k,{label:e(t)("page.jobTask.parallelNum"),path:"parallelNum"},{default:o(()=>[a(A,{value:r.parallelNum,"onUpdate:value":i[14]||(i[14]=p=>r.parallelNum=p),min:1,max:999,placeholder:e(t)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(k,{label:e(t)("page.jobTask.description"),path:"description"},{default:o(()=>[a(V,{value:r.description,"onUpdate:value":i[15]||(i[15]=p=>r.description=p),type:"textarea",placeholder:e(t)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Na=C({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search"],["update:model"]),setup(h,{emit:y}){const n=y,f=le(h,"model");function s(){n("reset")}function c(){n("search")}return(g,_)=>{const l=Re,u=de,R=X,r=ba;return S(),D(r,{model:f.value,onSearch:c,onReset:s},{default:o(()=>[a(l,{span:"24 s:12 m:6",label:e(t)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:o(()=>[a(Se,{value:f.value.groupName,"onUpdate:value":_[0]||(_[0]=I=>f.value.groupName=I)},null,8,["value"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:o(()=>[a(u,{value:f.value.jobName,"onUpdate:value":_[1]||(_[1]=I=>f.value.jobName=I),placeholder:e(t)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:o(()=>[a(R,{value:f.value.jobStatus,"onUpdate:value":_[2]||(_[2]=I=>f.value.jobStatus=I),placeholder:e(t)("page.jobTask.form.jobStatus"),options:e(Y)(e(ve))},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Sa=C({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:Q({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const y=le(h,"visible");return(n,f)=>{const s=_a,c=te,g=fa,_=xe;return S(),D(_,{modelValue:y.value,"onUpdate:modelValue":f[0]||(f[0]=l=>y.value=l),title:e(t)("page.jobTask.detail")},{default:o(()=>[a(g,{"label-placement":"top",bordered:"",column:2},{default:o(()=>[a(s,{label:e(t)("page.jobTask.groupName")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.jobName")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.jobName),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.taskType")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.taskType)},{default:o(()=>{var u;return[T(v(e(t)(e(je)[(u=n.rowData)==null?void 0:u.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.argsStr")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.argsStr),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.nextTriggerAt")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.nextTriggerAt),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.jobStatus")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.jobStatus)},{default:o(()=>{var u;return[T(v(e(t)(e(qe)[(u=n.rowData)==null?void 0:u.jobStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.routeKey")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.routeKey)},{default:o(()=>{var u;return[T(v(e(t)(e(Le)[(u=n.rowData)==null?void 0:u.routeKey])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorType")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.executorType)},{default:o(()=>{var u;return[T(v(e(t)(e(He)[(u=n.rowData)==null?void 0:u.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorInfo")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.executorInfo),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.triggerType")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.triggerType)},{default:o(()=>{var u;return[T(v(e(t)(e(he)[(u=n.rowData)==null?void 0:u.triggerType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.triggerInterval")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.triggerInterval),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.blockStrategy")},{default:o(()=>{var l;return[a(c,{type:e(L)((l=n.rowData)==null?void 0:l.blockStrategy)},{default:o(()=>{var u;return[T(v(e(t)(e(Ne)[(u=n.rowData)==null?void 0:u.blockStrategy])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorTimeout")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.executorTimeout),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.maxRetryTimes")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.maxRetryTimes),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.retryInterval")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.retryInterval),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.parallelNum")},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.parallelNum),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.description"),span:2},{default:o(()=>{var l;return[T(v((l=n.rowData)==null?void 0:l.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),xa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ye(h)}const Ha=C({name:"job_task",__name:"index",setup(h){const{hasAuth:y}=ra(),n=fe(),{routerPushByKey:f}=We(),s=z(),{bool:c,setTrue:g}=Qe(!1),{columnChecks:_,columns:l,data:u,getData:R,loading:r,mobilePagination:I,searchParams:O,resetSearchParams:re}=$e({apiFn:ea,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:t("common.index"),align:"center",width:48},{key:"jobName",title:t("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:m=>{async function d(){s.value=m,g()}return a(P,{text:!0,tag:"a",type:"primary",onClick:d,class:"ws-normal"},{default:()=>[m.jobName]})}},{key:"groupName",title:t("page.jobTask.groupName"),align:"left",width:180},{key:"nextTriggerAt",title:t("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:t("page.jobTask.jobStatus"),align:"center",width:60,render:m=>{const d=async(b,j)=>{var $;const{error:w}=await oa({id:m.id,jobStatus:b});w||(m.jobStatus=b,($=window.$message)==null||$.success(t("common.updateSuccess"))),j()};return a(la,{value:m.jobStatus,"onUpdate:value":b=>m.jobStatus=b,onFetch:d},null)}},{key:"taskType",title:t("page.jobTask.taskType"),align:"center",width:120,render:m=>{if(m.taskType===null)return null;const d={1:"info",2:"success",3:"error"},b=t(je[m.taskType]);return a(te,{type:d[m.taskType]},B(b)?b:{default:()=>[b]})}},{key:"triggerType",title:t("page.jobTask.triggerType"),align:"center",width:120,render:m=>{if(m.triggerType===null)return null;const d={2:"info",3:"success",99:"error"},b=t(he[m.triggerType]);return a(te,{type:d[m.triggerType]},B(b)?b:{default:()=>[b]})}},{key:"triggerInterval",title:t("page.jobTask.triggerInterval"),align:"center",width:80},{key:"blockStrategy",title:t("page.jobTask.blockStrategy"),align:"center",width:80,render:m=>{if(m.blockStrategy===null)return null;const d={1:"info",2:"success",3:"error"},b=t(Ne[m.blockStrategy]);return a(te,{type:d[m.blockStrategy]},B(b)?b:{default:()=>[b]})}},{key:"executorTimeout",title:t("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:t("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:t("common.operate"),align:"center",width:180,fixed:"right",render:m=>{let d,b;return a("div",{class:"flex-center gap-8px"},[a(pe,{onPositiveClick:()=>F(m.id)},{default:()=>t("common.confirmExecute"),trigger:()=>{let j;return a(P,{type:"error",text:!0,ghost:!0,size:"small"},B(j=t("common.execute"))?j:{default:()=>[j]})}}),a(ie,{vertical:!0},null),a(P,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>J(m.id)},B(d=t("common.batchList"))?d:{default:()=>[d]}),a(ie,{vertical:!0},null),a(P,{type:"warning",ghost:!0,text:!0,size:"small",onClick:()=>k(m.id)},B(b=t("common.edit"))?b:{default:()=>[b]}),y("R_ADMIN")?a(me,null,[a(ie,{vertical:!0},null),a(pe,{onPositiveClick:()=>V(m.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let j;return a(P,{type:"error",text:!0,ghost:!0,size:"small"},B(j=t("common.delete"))?j:{default:()=>[j]})}})]):""])}}]}),{drawerVisible:G,operateType:Z,editingData:ee,handleAdd:ne,handleEdit:se,checkedRowKeys:N,onDeleted:i}=Ue(u,R);async function V(m){const{error:d}=await aa(m);d||i()}function k(m){se(m)}async function F(m){var b,j;const{error:d}=await ta(m);d?(b=window.$message)==null||b.error(t("common.executeFailed")):(j=window.$message)==null||j.success(t("common.executeSuccess"))}function J(m){f("job_batch",{query:{jobId:m}})}function K(){return{jobIds:N.value,groupName:O.groupName,jobName:O.jobName,jobStatus:O.jobStatus}}function M(){Ce("/job/export",K(),t("page.jobTask.title"))}return(m,d)=>{const b=Oe,j=Ke,w=Ve,$=ga,U=ke;return S(),oe("div",xa,[a(Na,{model:e(O),"onUpdate:model":d[0]||(d[0]=x=>W(O)?O.value=x:null),onReset:e(re),onSearch:e(R)},null,8,["model","onReset","onSearch"]),a(U,{title:e(t)("page.jobTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":o(()=>[a(w,{columns:e(_),"onUpdate:columns":d[1]||(d[1]=x=>W(_)?_.value=x:null),loading:e(r),"show-delete":!1,onAdd:e(ne),onRefresh:e(R)},{addAfter:o(()=>[a(b,{action:"/job/import",accept:"application/json",onRefresh:e(R)},null,8,["onRefresh"]),a(e(pe),{onPositiveClick:M},{trigger:o(()=>[a(e(P),{size:"small",ghost:"",type:"primary",disabled:e(N).length===0&&e(y)("R_USER")},{icon:o(()=>[a(j,{class:"text-icon"})]),default:o(()=>[T(" "+v(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:o(()=>[T(v(e(N).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(N).length})),1)]),_:1})]),_:1},8,["columns","loading","onAdd","onRefresh"])]),default:o(()=>[a($,{"checked-row-keys":e(N),"onUpdate:checkedRowKeys":d[2]||(d[2]=x=>W(N)?N.value=x:null),columns:e(l),data:e(u),"flex-height":!e(n).isMobile,"scroll-x":2e3,loading:e(r),remote:"","row-key":x=>x.id,pagination:e(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(ha,{visible:e(G),"onUpdate:visible":d[3]||(d[3]=x=>W(G)?G.value=x:null),"operate-type":e(Z),"row-data":e(ee),onSubmitted:e(R)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(Sa,{visible:e(c),"onUpdate:visible":d[4]||(d[4]=x=>W(c)?c.value=x:null),"row-data":s.value},null,8,["visible","row-data"])])}}});export{Ha as default};
