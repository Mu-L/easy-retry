import{a as A,b as E,u as K,c as G,N as H,d as Q}from"./search-form.vue_vue_type_script_setup_true_lang-CHQfNlLV.js";import{bm as $,d as C,Q as O,R as M,o as S,c as x,w as s,f as a,h as e,$ as t,X,b_ as Z,s as J,a6 as Y,z as U,bo as ee,g as f,t as y,a9 as R,b$ as j,bZ as F,P as V,bk as te,c0 as ae,bl as le,C as oe,ad as ne,b as re,ae as T,B as W,O as se,ag as ue}from"./index-KP_OAqI5.js";import{_ as ie}from"./select-group.vue_vue_type_script_setup_true_lang-j0kz2NfN.js";import{_ as pe}from"./select-scene.vue_vue_type_script_setup_true_lang-BkZgN3Ig.js";import{_ as de}from"./detail-drawer-cn9EnkBY.js";import{_ as me,a as ce}from"./log-DQJkGq1i.js";import{_ as ge,a as fe}from"./DescriptionsItem-Q6F3Fays.js";import{_ as ye}from"./Grid-D4q1Pq5a.js";import"./group-BnlgYRpp.js";import"./retry-scene-DI15DHkn.js";function _e(p){return $({url:"/retry-task-log/list",method:"get",params:p})}function be(p){return $({url:`/retry-task-log/${p}`,method:"get"})}function ve(p){return $({url:`/retry-task-log/${p}`,method:"delete"})}function he(p){return $({url:"/retry-task-log/ids",method:"delete",data:p})}const Ne=C({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(p,{emit:w}){const b=w,u=M(p,"model");function v(){b("reset")}function D(){b("search")}return(h,i)=>{const d=A,_=J,L=Y,N=E;return S(),x(N,{model:u.value,onSearch:D,onReset:v},{default:s(()=>[a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[a(ie,{value:u.value.groupName,"onUpdate:value":i[0]||(i[0]=o=>u.value.groupName=o)},null,8,["value"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:s(()=>[a(pe,{value:u.value.sceneName,"onUpdate:value":i[1]||(i[1]=o=>u.value.sceneName=o),"group-name":u.value.groupName},null,8,["value","group-name"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:s(()=>[a(_,{value:u.value.uniqueId,"onUpdate:value":i[2]||(i[2]=o=>u.value.uniqueId=o),placeholder:e(t)("page.retryLog.form.UniqueId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:s(()=>[a(_,{value:u.value.idempotentId,"onUpdate:value":i[3]||(i[3]=o=>u.value.idempotentId=o),placeholder:e(t)("page.retryLog.form.idempotentId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:s(()=>[a(_,{value:u.value.bizNo,"onUpdate:value":i[4]||(i[4]=o=>u.value.bizNo=o),placeholder:e(t)("page.retryLog.form.bizNo")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.retryLog.retryStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:s(()=>[a(L,{value:u.value.retryStatus,"onUpdate:value":i[5]||(i[5]=o=>u.value.retryStatus=o),placeholder:e(t)("page.retryTask.form.retryStatus"),options:e(X)(e(Z)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),we=C({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:O({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){const w=p,b=M(p,"visible"),u=U([]),v=U(),D=new AbortController,h=U(!1);let i="0",d=0;async function _(){const{data:o,error:g}=await ce({groupName:w.rowData.groupName,uniqueId:w.rowData.uniqueId,startId:i,fromIndex:d,size:50});g||(h.value=o.finished,i=o.nextStartId,d=o.fromIndex,o.message&&(u.value.push(...o.message),u.value.sort((c,k)=>Number.parseInt(c.time_stamp,10)-Number.parseInt(k.time_stamp,10))),h.value||(clearTimeout(v.value),v.value=setTimeout(_,1e3)))}const L=async o=>{o===1&&u.value.length===0&&await _()},N=()=>{h.value=!0,D.abort(),clearTimeout(v.value),v.value=void 0};return ee(()=>{N()}),(o,g)=>{const c=ge,k=V,q=fe,I=te,r=me,n=ae,z=le,B=de;return S(),x(B,{modelValue:b.value,"onUpdate:modelValue":g[1]||(g[1]=l=>b.value=l),title:e(t)("page.retryLog.detail"),width:["50%","90%"]},{default:s(()=>[a(z,{type:"segment",animated:"","onUpdate:value":L},{default:s(()=>[a(I,{name:0,tab:e(t)("page.log.info")},{default:s(()=>[a(q,{"label-placement":"top",bordered:"",column:2},{default:s(()=>[a(c,{label:e(t)("page.retryLog.UniqueId"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.uniqueId),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.groupName"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.sceneName"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.sceneName),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.retryStatus"),span:1},{default:s(()=>{var l;return[a(k,{type:e(R)((l=o.rowData)==null?void 0:l.retryStatus)},{default:s(()=>{var m;return[f(y(e(t)(e(j)[(m=o.rowData)==null?void 0:m.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.taskType"),span:1},{default:s(()=>{var l;return[a(k,{type:e(R)((l=o.rowData)==null?void 0:l.taskType)},{default:s(()=>{var m;return[f(y(e(t)(e(F)[(m=o.rowData)==null?void 0:m.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.bizNo"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.bizNo),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryLog.idempotentId"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.idempotentId),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryTask.executorName"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.executorName),1)]}),_:1},8,["label"]),a(c,{label:e(t)("page.retryTask.argsStr"),span:2},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.argsStr),1)]}),_:1},8,["label"]),a(c,{label:e(t)("common.createDt")},{default:s(()=>{var l;return[f(y((l=o.rowData)==null?void 0:l.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),a(I,{name:1,tab:e(t)("page.log.title"),"display-directive":"if"},{default:s(()=>[u.value.length>0?(S(),x(r,{key:0,modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=l=>u.value=l),drawer:!1},null,8,["modelValue"])):(S(),x(n,{key:1,class:"h-full"}))]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function P(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!ue(p)}const ze=C({name:"retry_log",__name:"index",setup(p){const w=oe(),b=U(),{bool:u,setTrue:v}=ne(!1),{columns:D,columnChecks:h,data:i,getData:d,loading:_,mobilePagination:L,searchParams:N,resetSearchParams:o}=K({apiFn:_e,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null,retryStatus:null},columns:()=>[{type:"selection",align:"center",width:48,disabled:r=>r.retryStatus!==1},{key:"index",title:t("common.index"),align:"center",width:64},{key:"uniqueId",title:t("page.retryLog.UniqueId"),align:"left",minWidth:120,render:r=>{async function n(){await q(r),v()}return a(W,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[r.uniqueId]})}},{key:"groupName",title:t("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:t("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:t("page.retryLog.retryStatus"),align:"left",minWidth:120,render:r=>{if(r.retryStatus===null)return null;const n=t(j[r.retryStatus]);return a(V,{type:R(r.retryStatus)},P(n)?n:{default:()=>[n]})}},{key:"taskType",title:t("page.retryLog.taskType"),align:"left",minWidth:120,render:r=>{if(r.taskType===null)return null;const n=t(F[r.taskType]);return a(V,{type:R(r.taskType)},P(n)?n:{default:()=>[n]})}},{key:"idempotentId",title:t("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:t("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:t("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:r=>a("div",{class:"flex-center gap-8px"},[r.retryStatus===1?a(H,{onPositiveClick:()=>k(r.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let n;return a(W,{type:"error",text:!0,ghost:!0,size:"small"},P(n=t("common.delete"))?n:{default:()=>[n]})}}):""])}]}),{checkedRowKeys:g}=G(i,d);async function c(){var n;const{error:r}=await he(g.value);r||((n=window.$message)==null||n.success(t("common.deleteSuccess")),d())}async function k(r){var n;await ve(r),(n=window.$message)==null||n.success(t("common.deleteSuccess")),d()}async function q(r){const n=await be(r.id);b.value=n.data||null}function I(){const r=history.state.retryStatus;r&&(N.retryStatus=r,d())}return I(),(r,n)=>{const z=Q,B=ye,l=se;return S(),re("div",ke,[a(Ne,{model:e(N),"onUpdate:model":n[0]||(n[0]=m=>T(N)?N.value=m:null),onReset:e(o),onSearch:e(d)},null,8,["model","onReset","onSearch"]),a(l,{title:e(t)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[a(z,{columns:e(h),"onUpdate:columns":n[1]||(n[1]=m=>T(h)?h.value=m:null),"disabled-delete":e(g).length===0,loading:e(_),"show-add":!1,onDelete:c,onRefresh:e(d)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:s(()=>[a(B,{"checked-row-keys":e(g),"onUpdate:checkedRowKeys":n[2]||(n[2]=m=>T(g)?g.value=m:null),columns:e(D),data:e(i),"flex-height":!e(w).isMobile,"scroll-x":962,loading:e(_),remote:"","row-key":m=>m.id,pagination:e(L),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(we,{visible:e(u),"onUpdate:visible":n[3]||(n[3]=m=>T(u)?u.value=m:null),"row-data":b.value},null,8,["visible","row-data"])])}}});export{ze as default};
