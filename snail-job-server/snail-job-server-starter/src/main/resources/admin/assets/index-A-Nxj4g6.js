import{_ as be,u as _e,a as ve,N as he,b as Se}from"./table-Bdl3-G-Y.js";import{d as te,U as Z,p as G,V as ee,Y as P,a as Te,$ as a,i as Ne,aL as we,r as ke,W as fe,o as N,c as $,w as n,f as t,g as I,t as U,h as e,cp as Ce,S as W,b as le,Q as se,R as ie,bu as re,a6 as de,a2 as De,a3 as Ie,bt as Ue,n as Le,B as X,cq as ue,cr as Re,cs as $e,a8 as x,ct as ce,bw as Ve,cu as me,cv as ye,N as q,s as xe,ac as Oe,ad as E,cw as je,M as Be,I as Me,ae as Fe}from"./index-CHgAHQIl.js";import{d as Ge,e as Ae,g as ze,h as Pe,i as pe,j as Ee}from"./notify-CFgOuaRf.js";import{u as qe,a as We}from"./form-BuwwOwyC.js";import{_ as ge}from"./operate-drawer-3XJn0MkC.js";import{f as He}from"./retry-scene-BlErNK4f.js";import{f as Ke}from"./workflow-B4-fagod.js";import{i as Je}from"./job-ClIVIZwj.js";import{_ as Qe}from"./select-group.vue_vue_type_script_setup_true_lang-fZ9yr9an.js";import{_ as Ye,a as Xe}from"./FormItem-B3tfy17D.js";import{_ as Ze}from"./Space-CeVCCXQI.js";import{c as et,d as tt,_ as at}from"./Grid-DHGKk79k.js";import{_ as nt}from"./search-form.vue_vue_type_script_setup_true_lang-BfZ4by1v.js";import{_ as ot,a as lt}from"./DescriptionsItem-sCQ7QkHp.js";import{_ as st}from"./status-switch.vue_vue_type_script_setup_true_lang-DFxhp7sV.js";import{u as it}from"./auth-uwVlWSMM.js";import"./close-fullscreen-rounded-DtEdfPev.js";import"./group-BUALrrKR.js";import"./round-search-KK91k1IY.js";const rt=te({name:"NotifyConfigOperateDrawer",__name:"notify-config-operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{},retrySceneDisable:{type:Boolean,default:!0},retrySceneDisableModifiers:{}}),emits:Z(["update:value","submitted"],["update:visible","update:retrySceneDisable"]),setup(S,{emit:O}){const L=G([]),f=G([]),C=G([]),g=G([]),y=S,v=O,h=ee(S,"visible"),d=ee(S,"retrySceneDisable"),w=G(P(ue)),{formRef:i,validate:c,restoreValidation:ae}=qe(),{defaultRequiredRule:D}=We(),ne=Te(()=>({add:a("page.notifyConfig.addNotifyConfig"),edit:a("page.notifyConfig.editNotifyConfig")})[y.operateType]);Ne(()=>{we(()=>{oe()})});async function oe(){const m=await Ge();L.value=m.data}const o=ke(H());function H(){return{groupName:null,businessId:"",recipientIds:[],systemTaskType:null,notifyStatus:1,notifyScene:null,notifyThreshold:16,rateLimiterStatus:0,rateLimiterThreshold:100,description:""}}const j={groupName:D,businessId:D,notifyStatus:D,notifyScene:D,recipientIds:D,rateLimiterStatus:D,notifyThreshold:D};function K(){if(y.operateType==="add"){Object.assign(o,H()),d.value=!0;return}y.operateType==="edit"&&y.rowData&&(Object.assign(o,y.rowData),r(o.systemTaskType),l(o.notifyScene))}function J(){h.value=!1}async function Q(){var m;if(await c(),y.operateType==="add"){const{groupName:s,businessId:u,recipientIds:T,systemTaskType:V,notifyStatus:R,notifyScene:k,notifyThreshold:b,rateLimiterStatus:B,rateLimiterThreshold:M,description:A}=o,{error:z}=await Ae({groupName:s,businessId:u,recipientIds:T,systemTaskType:V,notifyStatus:R,notifyScene:k,notifyThreshold:b,rateLimiterStatus:B,rateLimiterThreshold:M,description:A});if(z)return}if(y.operateType==="edit"){const{id:s,groupName:u,businessId:T,recipientIds:V,notifyStatus:R,systemTaskType:k,notifyScene:b,notifyThreshold:B,rateLimiterStatus:M,rateLimiterThreshold:A,description:z}=o,{error:Y}=await ze({id:s,groupName:u,businessId:T,recipientIds:V,systemTaskType:k,notifyStatus:R,notifyScene:b,notifyThreshold:B,rateLimiterStatus:M,rateLimiterThreshold:A,description:z});if(Y)return}(m=window.$message)==null||m.success(a("common.updateSuccess")),J(),v("submitted")}async function r(m){var s,u,T,V,R;if(m===1){const k=await He({groupName:o.groupName});f.value=k.data,w.value=P(ue)}else if(m===3){const k=await Je({groupName:o.groupName});C.value=(s=k.data)==null?void 0:s.map(b=>(b.id=String(b.id),b)),w.value=P(Re)}else if(m===4){const k=await Ke({groupName:o.groupName});g.value=(u=k.data)==null?void 0:u.map(b=>(b.id=String(b.id),b)),w.value=P($e)}m!==((T=y.rowData)==null?void 0:T.systemTaskType)?(o.businessId=null,o.notifyScene=null):(o.businessId=(V=y.rowData)==null?void 0:V.businessId,o.notifyScene=(R=y.rowData)==null?void 0:R.notifyScene)}async function l(m){d.value=!(m===5||m===6)}function _(m){K(),o.groupName=m,r(1),l(1)}return fe(h,()=>{h.value&&(K(),ae())}),(m,s)=>{const u=Ye,T=de,V=De,R=Ze,k=Ie,b=et,B=Ue,M=tt,A=Le,z=Xe,Y=X;return N(),$(ge,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=p=>h.value=p),title:ne.value,"min-size":480,onHandleSubmit:Q},{footer:n(()=>[t(R,{size:16},{default:n(()=>[t(Y,{onClick:J},{default:n(()=>[I(U(e(a)("common.cancel")),1)]),_:1}),t(Y,{type:"primary",onClick:Q},{default:n(()=>[I(U(e(a)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(z,{ref_key:"formRef",ref:i,model:o,rules:j},{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.groupName"),path:"groupName"},{default:n(()=>[t(Qe,{modelValue:o.groupName,"onUpdate:modelValue":[s[0]||(s[0]=p=>o.groupName=p),_]},null,8,["modelValue"])]),_:1},8,["label"]),t(u,{label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType"},{default:n(()=>[t(T,{value:o.systemTaskType,"onUpdate:value":[s[1]||(s[1]=p=>o.systemTaskType=p),r],placeholder:e(a)("page.notifyConfig.form.systemTaskType"),options:e(P)(e(Ce)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o.systemTaskType===1?(N(),$(u,{key:0,label:e(a)("page.notifyConfig.retryScene"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[2]||(s[2]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.sceneName"),options:f.value,"label-field":"sceneName","value-field":"sceneName",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),o.systemTaskType===3?(N(),$(u,{key:1,label:e(a)("page.notifyConfig.job"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[3]||(s[3]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.jobName"),options:C.value,"label-field":"jobName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),o.systemTaskType===4?(N(),$(u,{key:2,label:e(a)("page.notifyConfig.workflow"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[4]||(s[4]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.workflowName"),options:g.value,"label-field":"workflowName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),t(u,{label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene"},{default:n(()=>[t(T,{value:o.notifyScene,"onUpdate:value":[s[5]||(s[5]=p=>o.notifyScene=p),l],placeholder:e(a)("page.notifyConfig.form.notifyScene"),options:w.value,clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(u,{label:e(a)("page.notifyConfig.notifyRecipient"),path:"recipientIds"},{default:n(()=>[t(T,{value:o.recipientIds,"onUpdate:value":s[6]||(s[6]=p=>o.recipientIds=p),placeholder:e(a)("page.notifyConfig.form.notifyRecipient"),options:L.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(M,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(b,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus"},{default:n(()=>[t(k,{value:o.notifyStatus,"onUpdate:value":s[7]||(s[7]=p=>o.notifyStatus=p),name:"notifyStatus"},{default:n(()=>[t(R,null,{default:n(()=>[(N(!0),le(se,null,ie(e(re),p=>(N(),$(V,{key:p.value,value:p.value,label:e(a)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t(b,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.notifyThreshold"),path:"notifyThreshold"},{default:n(()=>[t(B,{value:o.notifyThreshold,"onUpdate:value":s[8]||(s[8]=p=>o.notifyThreshold=p),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:d.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(M,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(b,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.rateLimiterStatus"),path:"rateLimiterStatus"},{default:n(()=>[t(k,{value:o.rateLimiterStatus,"onUpdate:value":s[9]||(s[9]=p=>o.rateLimiterStatus=p),name:"rateLimiterStatus",disabled:d.value},{default:n(()=>[t(R,null,{default:n(()=>[(N(!0),le(se,null,ie(e(re),p=>(N(),$(V,{key:p.value,value:p.value,label:e(a)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])]),_:1}),t(b,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.rateLimiterThreshold"),path:"notifyThreshold"},{default:n(()=>[t(B,{value:o.rateLimiterThreshold,"onUpdate:value":s[10]||(s[10]=p=>o.rateLimiterThreshold=p),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:d.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(u,{label:e(a)("page.notifyConfig.description"),path:"description"},{default:n(()=>[t(A,{value:o.description,"onUpdate:value":s[11]||(s[11]=p=>o.description=p),type:"textarea",placeholder:e(a)("page.notifyConfig.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ut=te({name:"NotifyConfigSearch",__name:"notify-config-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(S,{emit:O}){const L=O,f=ee(S,"model");function C(){L("reset")}function g(){L("search")}return(y,v)=>{const h=de,d=be,w=nt;return N(),$(w,{model:f.value,onSearch:g,onReset:C},{default:n(()=>[t(d,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(h,{value:f.value.groupName,"onUpdate:value":v[0]||(v[0]=i=>f.value.groupName=i),placeholder:e(a)("page.notifyConfig.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus",class:"pr-24px"},{default:n(()=>[t(h,{value:f.value.notifyStatus,"onUpdate:value":v[1]||(v[1]=i=>f.value.notifyStatus=i),placeholder:e(a)("page.notifyConfig.notifyStatus"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene",class:"pr-24px"},{default:n(()=>[t(h,{value:f.value.notifyScene,"onUpdate:value":v[2]||(v[2]=i=>f.value.notifyScene=i),placeholder:e(a)("page.notifyConfig.notifyScene"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),pt=te({name:"NotifyConfigDetailDrawer",__name:"notify-config-detail-drawer",props:Z({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const O=S,L=ee(S,"visible");return fe(()=>O.rowData,()=>{console.log(O.rowData)},{immediate:!0}),(f,C)=>{const g=ot,y=q,v=lt,h=ge;return N(),$(h,{modelValue:L.value,"onUpdate:modelValue":C[0]||(C[0]=d=>L.value=d),title:e(a)("page.groupConfig.detail")},{default:n(()=>[t(v,{"label-placement":"top",bordered:"",column:2},{default:n(()=>{var d,w;return[t(g,{label:e(a)("page.notifyConfig.businessName"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.businessName),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.groupConfig.groupName"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.groupName),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.systemTaskType"),span:1},{default:n(()=>{var i;return[t(y,{type:e(x)((i=f.rowData)==null?void 0:i.systemTaskType)},{default:n(()=>{var c;return[I(U(e(a)(e(ce)[(c=f.rowData)==null?void 0:c.systemTaskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.notifyStatus"),span:1},{default:n(()=>{var i;return[t(y,{type:e(x)((i=f.rowData)==null?void 0:i.notifyStatus)},{default:n(()=>{var c;return[I(U(e(a)(e(Ve)[(c=f.rowData)==null?void 0:c.notifyStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),((d=f.rowData)==null?void 0:d.systemTaskType)===1?(N(),$(g,{key:0,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(y,{type:e(x)((i=f.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var c;return[I(U(e(a)(e(me)[(c=f.rowData)==null?void 0:c.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):W("",!0),((w=f.rowData)==null?void 0:w.systemTaskType)===3?(N(),$(g,{key:1,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(y,{type:e(x)((i=f.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var c;return[I(U(e(a)(e(ye)[(c=f.rowData)==null?void 0:c.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):W("",!0),t(g,{label:e(a)("page.notifyConfig.notifyThreshold"),span:1},{default:n(()=>{var i;return[t(y,{type:e(x)((i=f.rowData)==null?void 0:i.notifyThreshold)},{default:n(()=>{var c;return[I(U((c=f.rowData)==null?void 0:c.notifyThreshold),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(g,{label:e(a)("common.createDt"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.createDt),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.description"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.description),1)]}),_:1},8,["label"])]}),_:1})]),_:1},8,["modelValue","title"])}}}),ft={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function F(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Fe(S)}const Rt=te({name:"notify_scene",__name:"index",setup(S){const{hasAuth:O}=it(),L=xe(),f=G(),{bool:C,setTrue:g}=Oe(!1),{columns:y,columnChecks:v,data:h,getData:d,loading:w,mobilePagination:i,searchParams:c,resetSearchParams:ae}=_e({apiFn:Pe,apiParams:{page:1,size:10,groupName:null,notifyStatus:null,notifyScene:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:a("common.index"),align:"center",width:64},{key:"businessName",title:a("page.notifyConfig.businessName"),align:"left",width:120,render:r=>{function l(){f.value=r||null,g()}return t(X,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[r.businessName]})}},{key:"groupName",title:a("page.notifyConfig.groupName"),align:"left",width:120},{key:"systemTaskType",title:a("page.notifyConfig.systemTaskType"),align:"left",width:120,render:r=>{if(r.systemTaskType===null)return null;const l=a(ce[r.systemTaskType]);return t(q,{type:x(r.systemTaskType)},F(l)?l:{default:()=>[l]})}},{key:"notifyStatus",title:a("page.notifyConfig.notifyStatus"),align:"left",width:120,render:r=>{const l=async(_,m)=>{var u;const{error:s}=await Ee(r.id,_);s||(r.notifyStatus=_,(u=window.$message)==null||u.success(a("common.updateSuccess"))),m()};return t(st,{value:r.notifyStatus,"onUpdate:value":_=>r.notifyStatus=_,onFetch:l},null)}},{key:"notifyScene",title:a("page.notifyConfig.notifyScene"),align:"left",width:160,render:r=>{if(r.notifyScene===null)return null;if(r.systemTaskType===1){const l=a(me[r.notifyScene]);return t(q,{type:x(r.notifyScene)},F(l)?l:{default:()=>[l]})}if(r.systemTaskType===3){const l=a(ye[r.notifyScene]);return t(q,{type:x(r.notifyScene)},F(l)?l:{default:()=>[l]})}if(r.systemTaskType===4){const l=a(je[r.notifyScene]);return t(q,{type:x(r.notifyScene)},F(l)?l:{default:()=>[l]})}return null}},{key:"notifyThreshold",title:a("page.notifyConfig.notifyThreshold"),align:"left",width:120},{key:"createDt",title:a("common.createDt"),align:"left",width:120},{key:"description",title:a("page.notifyConfig.description"),align:"left",width:120},{key:"operate",title:a("common.operate"),align:"center",width:130,fixed:"right",render:r=>{let l;return t("div",{class:"flex-center gap-8px"},[t(X,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>Q(r.id)},F(l=a("common.edit"))?l:{default:()=>[l]}),O("R_ADMIN")?t(se,null,[t(Be,{vertical:!0},null),t(he,{onPositiveClick:()=>J(r.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let _;return t("span",null,[t(X,{type:"error",text:!0,ghost:!0,size:"small"},F(_=a("common.delete"))?_:{default:()=>[_]})])}})]):""])}}]}),{drawerVisible:D,operateType:ne,editingData:oe,handleAdd:o,handleEdit:H,checkedRowKeys:j}=ve(h,d);async function K(){var l;const{error:r}=await pe(j.value);r||((l=window.$message)==null||l.success(a("common.deleteSuccess")),d())}async function J(r){var _;const{error:l}=await pe([r]);l||((_=window.$message)==null||_.success(a("common.deleteSuccess")),d())}function Q(r){H(r)}return(r,l)=>{const _=Se,m=at,s=Me;return N(),le("div",ft,[t(ut,{model:e(c),"onUpdate:model":l[0]||(l[0]=u=>E(c)?c.value=u:null),onReset:e(ae),onSearch:e(d)},null,8,["model","onReset","onSearch"]),t(s,{title:e(a)("page.notifyConfig.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[t(_,{columns:e(v),"onUpdate:columns":l[1]||(l[1]=u=>E(v)?v.value=u:null),"disabled-delete":e(j).length===0,loading:e(w),onAdd:e(o),onDelete:K,onRefresh:e(d)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[t(m,{"checked-row-keys":e(j),"onUpdate:checkedRowKeys":l[2]||(l[2]=u=>E(j)?j.value=u:null),columns:e(y),data:e(h),"flex-height":!e(L).isMobile,"scroll-x":962,loading:e(w),remote:"","row-key":u=>u.id,pagination:e(i),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(rt,{visible:e(D),"onUpdate:visible":l[3]||(l[3]=u=>E(D)?D.value=u:null),"operate-type":e(ne),"row-data":e(oe),onSubmitted:e(d)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(pt,{visible:e(C),"onUpdate:visible":l[4]||(l[4]=u=>E(C)?C.value=u:null),"row-data":f.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Rt as default};
