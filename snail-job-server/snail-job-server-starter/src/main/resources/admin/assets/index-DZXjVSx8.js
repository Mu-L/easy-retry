import{a as O,b as T,u as z,c as j,N as A,d as F}from"./search-form.vue_vue_type_script_setup_true_lang-CHQfNlLV.js";import{d as W,Q as G,z as L,R as K,o as D,c as V,w as m,f as l,h as a,$ as o,a6 as E,ct as H,bs as Q,C as J,b as X,ae as S,B as x,bp as Y,P as R,bq as Z,O as ee,ag as te}from"./index-KP_OAqI5.js";import{f as ae,a as oe,b as le}from"./workflow-qbjTAN7o.js";import{_ as se}from"./select-group.vue_vue_type_script_setup_true_lang-j0kz2NfN.js";import{_ as ne}from"./task-batch-status.vue_vue_type_script_setup_true_lang-pMxRF8YH.js";import{_ as re}from"./Grid-D4q1Pq5a.js";import"./group-BnlgYRpp.js";const ce=W({name:"WorkflowBatchSearch",__name:"workflow-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(p,{emit:_}){const f=_,g=L([]),r=K(p,"model");function B(){f("reset")}function h(){f("search")}async function w(c){const s=await ae({groupName:c});g.value=s.data}return w(""),(c,s)=>{const k=O,d=E,b=T;return D(),V(b,{model:r.value,onSearch:h,onReset:B},{default:m(()=>[l(k,{span:"24 s:12 m:6",label:a(o)("page.workflowBatch.groupName"),path:"groupName",class:"pr-24px"},{default:m(()=>[l(se,{value:r.value.groupName,"onUpdate:value":[s[0]||(s[0]=n=>r.value.groupName=n),w]},null,8,["value"])]),_:1},8,["label"]),l(k,{span:"24 s:12 m:6",label:a(o)("page.workflowBatch.workflowName"),"label-width":100,path:"workflowName",class:"pr-24px"},{default:m(()=>[l(d,{value:r.value.workflowId,"onUpdate:value":s[1]||(s[1]=n=>r.value.workflowId=n),placeholder:a(o)("page.workflowBatch.form.workflowName"),"value-field":"id","label-field":"workflowName",options:g.value,clearable:"",filterable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),l(k,{span:"24 s:12 m:6",label:a(o)("page.workflowBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:m(()=>[l(ne,{value:r.value.taskBatchStatus,"onUpdate:value":s[2]||(s[2]=n=>r.value.taskBatchStatus=n)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function v(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!te(p)}const ke=W({name:"workflow_batch",__name:"index",setup(p){var y,N;const _=H(),f=Q(),g=((y=f.query)==null?void 0:y.workflowId)===void 0?null:Number.parseInt((N=f.query)==null?void 0:N.workflowId,10),r=J(),{columns:B,columnChecks:h,data:w,getData:c,loading:s,mobilePagination:k,searchParams:d,resetSearchParams:b}=z({apiFn:oe,apiParams:{page:1,size:10,workflowId:g,groupName:null,taskBatchStatus:null},columns:()=>[{key:"id",title:o("common.index"),align:"center",width:120,render:e=>{function t(){I(e.id)}return l(x,{text:!0,tag:"a",type:"primary",onClick:t,class:"ws-normal"},{default:()=>[e.id]})}},{key:"workflowName",title:o("page.workflowBatch.workflowName"),align:"left",minWidth:120},{key:"groupName",title:o("page.workflowBatch.groupName"),align:"left",minWidth:120},{key:"executionAt",title:o("page.workflowBatch.executionAt"),align:"left",minWidth:120},{key:"taskBatchStatus",title:o("page.workflowBatch.taskBatchStatus"),align:"left",minWidth:120,render:e=>{if(!e.taskBatchStatus)return null;const t={1:"info",2:"success",3:"success",4:"error",5:"warning",6:"warning"},i=o(Y[e.taskBatchStatus]);return l(R,{type:t[e.taskBatchStatus]},v(i)?i:{default:()=>[i]})}},{key:"operationReason",title:o("page.workflowBatch.operationReason"),align:"left",minWidth:120,render:e=>{if(!e.operationReason)return null;const t=o(Z[e.operationReason]);return l(R,{type:"warning"},v(t)?t:{default:()=>[t]})}},{key:"createDt",title:o("page.workflowBatch.createDt"),align:"left",minWidth:120},{key:"operate",title:o("common.operate"),align:"center",width:130,render:e=>l("div",{class:"flex-center gap-8px"},[(e==null?void 0:e.taskBatchStatus)===1||(e==null?void 0:e.taskBatchStatus)===2?l(A,{onPositiveClick:()=>C(e.id)},{default:()=>o("common.confirmStop"),trigger:()=>{let t;return l(x,{type:"error",text:!0,ghost:!0,size:"small"},v(t=o("common.stop"))?t:{default:()=>[t]})}}):""])}]}),{checkedRowKeys:n,onBatchDeleted:P}=j(w,c);async function $(){P()}async function C(e){var i;const{error:t}=await le(e);t||((i=window.$message)==null||i.success(o("common.executeSuccess")),c())}function I(e){_.push({path:"/workflow/form/batch",query:{id:e}})}function U(){const e=history.state.taskBatchStatus;e&&(d.taskBatchStatus=e,c())}return U(),(e,t)=>{const i=F,q=re,M=ee;return D(),X("div",ie,[l(ce,{model:a(d),"onUpdate:model":t[0]||(t[0]=u=>S(d)?d.value=u:null),onReset:a(b),onSearch:a(c)},null,8,["model","onReset","onSearch"]),l(M,{title:a(o)("page.workflowBatch.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":m(()=>[l(i,{columns:a(h),"onUpdate:columns":t[1]||(t[1]=u=>S(h)?h.value=u:null),"disabled-delete":a(n).length===0,loading:a(s),"show-add":!1,"show-delete":!1,onDelete:$,onRefresh:a(c)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:m(()=>[l(q,{"checked-row-keys":a(n),"onUpdate:checkedRowKeys":t[2]||(t[2]=u=>S(n)?n.value=u:null),columns:a(B),data:a(w),"flex-height":!a(r).isMobile,"scroll-x":962,loading:a(s),remote:"","row-key":u=>u.id,pagination:a(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{ke as default};
