import{_ as ue}from"./table-header-operation.vue_vue_type_script_setup_true_lang-ntuddL0e.js";import{d as B,U as A,V as Y,a as pe,$ as t,p as X,r as se,W as Z,o as G,c as x,w as n,f as o,g as w,t as y,h as e,b as z,Q,X as de,R as L,Y as ge,Z as ce,a0 as me,a1 as fe,n as ee,B as q,a2 as _e,O as be,a3 as ve,a4 as F,a5 as he,a6 as oe,a7 as te,N as K,s as Se,a8 as Ce,a9 as $,I as we,aa as ye}from"./index-DQvTTbM-.js";import{f as Ne,a as ke,b as De,c as Ge,d as Me}from"./group-DKztxFm0.js";import{_ as Re,u as Te,a as Ue}from"./table-BY-eM7wn.js";import{_ as Pe}from"./status-switch.vue_vue_type_script_setup_true_lang-BMqUMIex.js";import{u as $e}from"./auth-Ncng77z3.js";import{_ as ae}from"./operate-drawer-CZXJ_kn-.js";import{_ as xe}from"./round-search-DSNvd4Y0.js";import{u as Oe,a as Ve,_ as Ie,b as Fe}from"./form-Bu4MD_Ly.js";import{_ as Ae,a as Be,b as je}from"./Grid-CSTnYjse.js";import{N as Ee,a as We}from"./CollapseItem-Cc60zQbl.js";import{_ as ze}from"./Space-B5Upi9VN.js";import{_ as Le,a as qe}from"./DescriptionsItem-Bd4R5YlG.js";import{_ as Ke}from"./search-form.vue_vue_type_script_setup_true_lang-gb65EZBS.js";import"./close-fullscreen-rounded-BQkrG2tL.js";const Ye=B({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(v,{emit:N}){const g=v,d=N,m=Y(v,"visible"),{formRef:f,validate:k,restoreValidation:S}=Oe(),{defaultRequiredRule:_}=Ve(),r=pe(()=>({add:t("page.groupConfig.addGroupConfig"),edit:t("page.groupConfig.editGroupConfig")})[g.operateType]),c=X([]),i=se(R());function R(){return{groupName:"",token:I(32),groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const j={groupName:_,token:_,groupStatus:_,idGeneratorMode:_,initScene:_,groupPartition:_};function U(){if(g.operateType==="add"){Object.assign(i,R());return}g.operateType==="edit"&&g.rowData&&Object.assign(i,g.rowData)}function O(){m.value=!1}async function V(){var C,a;if(await k(),g.operateType==="add"){const{groupName:l,token:p,groupStatus:b,description:h,idGeneratorMode:s,initScene:D,groupPartition:M}=i,{error:P}=await Ne({groupName:l,token:p,groupStatus:b,description:h,idGeneratorMode:s,initScene:D,groupPartition:M});if(P)return;(C=window.$message)==null||C.success(t("common.addSuccess"))}else{const{groupName:l,token:p,groupStatus:b,description:h,idGeneratorMode:s,initScene:D,groupPartition:M}=i,{error:P}=await ke({groupName:l,token:p,groupStatus:b,description:h,idGeneratorMode:s,initScene:D,groupPartition:M});if(P)return;(a=window.$message)==null||a.success(t("common.updateSuccess"))}O(),d("submitted")}function E(){i.token=I(32)}function I(C){const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let l="SJ_";for(let p=0;p<C;p+=1){const b=Math.floor(Math.random()*a.length);l+=a.substring(b,b+1)}return l}const T=async()=>{const{data:C}=await De();c.value=C.map(a=>String(a))};return Z(m,()=>{m.value&&(T(),U(),S())}),(C,a)=>{const l=ee,p=Ie,b=Be,h=ze,s=Ae,D=xe,M=q,P=_e,ne=be,H=Ee,J=ve,le=We,re=Fe,ie=ae;return G(),x(ie,{modelValue:m.value,"onUpdate:modelValue":a[7]||(a[7]=u=>m.value=u),title:r.value,onSubmitted:V},{footer:n(()=>[o(h,{size:16},{default:n(()=>[o(M,{onClick:O},{default:n(()=>[w(y(e(t)("common.cancel")),1)]),_:1}),o(M,{type:"primary",onClick:V},{default:n(()=>[w(y(e(t)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[o(re,{ref_key:"formRef",ref:f,model:i,rules:j},{default:n(()=>[o(le,{"default-expanded-names":["1","2"]},{default:n(()=>[o(H,{title:e(t)("page.groupConfig.commonConfig"),name:"1"},{default:n(()=>[o(p,{label:e(t)("page.groupConfig.groupName"),path:"groupName"},{default:n(()=>[o(l,{value:i.groupName,"onUpdate:value":a[0]||(a[0]=u=>i.groupName=u),maxlength:64,"show-count":"",placeholder:e(t)("page.groupConfig.form.groupName"),disabled:g.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),o(p,{label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:n(()=>[o(s,{value:i.groupStatus,"onUpdate:value":a[1]||(a[1]=u=>i.groupStatus=u),name:"groupStatus"},{default:n(()=>[o(h,null,{default:n(()=>[(G(!0),z(L,null,Q(e(de),u=>(G(),x(b,{key:u.value,value:u.value,label:e(t)(u.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(p,{label:e(t)("page.groupConfig.token"),path:"token"},{default:n(()=>[o(ne,null,{default:n(()=>[o(l,{value:i.token,"onUpdate:value":a[2]||(a[2]=u=>i.token=u),maxlength:64,placeholder:e(t)("page.groupConfig.form.token"),disabled:g.operateType==="edit"},null,8,["value","placeholder","disabled"]),o(P,{trigger:"hover"},{trigger:n(()=>[o(M,{type:"default",ghost:"",disabled:g.operateType==="edit",onClick:E},{default:n(()=>[o(D,{class:"text-icon"})]),_:1},8,["disabled"])]),default:n(()=>[w(" "+y(e(t)("page.groupConfig.generateToken")),1)]),_:1})]),_:1})]),_:1},8,["label"]),o(p,{label:e(t)("page.groupConfig.description"),path:"description"},{default:n(()=>[o(l,{value:i.description,"onUpdate:value":a[3]||(a[3]=u=>i.description=u),type:"textarea",maxlength:256,"show-count":"",placeholder:e(t)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),o(H,{title:e(t)("page.groupConfig.retryConfig"),name:"2"},{default:n(()=>[o(p,{label:e(t)("page.groupConfig.idGeneratorMode"),path:"idGeneratorMode"},{default:n(()=>[o(J,{value:i.idGeneratorMode,"onUpdate:value":a[4]||(a[4]=u=>i.idGeneratorMode=u),placeholder:e(t)("page.groupConfig.form.idGeneratorMode"),options:e(ge)(e(ce))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o(p,{label:e(t)("page.groupConfig.initScene"),path:"initScene"},{default:n(()=>[o(s,{value:i.initScene,"onUpdate:value":a[5]||(a[5]=u=>i.initScene=u),name:"initScene"},{default:n(()=>[o(h,null,{default:n(()=>[(G(!0),z(L,null,Q(e(me),u=>(G(),x(b,{key:u.value,value:u.value,label:e(t)(u.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(p,{label:e(t)("page.groupConfig.groupPartition"),path:"groupPartition"},{default:n(()=>[o(J,{value:i.groupPartition,"onUpdate:value":a[6]||(a[6]=u=>i.groupPartition=u),placeholder:e(t)("page.groupConfig.form.groupPartition"),options:e(fe)(c.value)},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),He=B({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:A({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const N=v,g=Y(v,"visible");return Z(()=>N.rowData,()=>{console.log(N.rowData)},{immediate:!0}),(d,m)=>{const f=Le,k=K,S=qe,_=ae;return G(),x(_,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=r=>g.value=r),title:e(t)("page.groupConfig.detail")},{default:n(()=>[o(S,{"label-placement":"top",bordered:"",column:2},{default:n(()=>[o(f,{label:e(t)("page.groupConfig.groupName"),span:2},{default:n(()=>{var r;return[w(y((r=d.rowData)==null?void 0:r.groupName),1)]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.token"),span:2},{default:n(()=>{var r;return[w(y((r=d.rowData)==null?void 0:r.token),1)]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.groupStatus"),span:1},{default:n(()=>{var r;return[o(k,{type:e(F)((r=d.rowData)==null?void 0:r.groupStatus)},{default:n(()=>{var c;return[w(y(e(t)(e(he)[(c=d.rowData)==null?void 0:c.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.idGeneratorMode"),span:1},{default:n(()=>{var r;return[o(k,{type:e(F)((r=d.rowData)==null?void 0:r.idGeneratorMode)},{default:n(()=>{var c;return[w(y(e(t)(e(oe)[(c=d.rowData)==null?void 0:c.idGeneratorMode])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.groupPartition"),span:1},{default:n(()=>{var r;return[w(y((r=d.rowData)==null?void 0:r.groupPartition),1)]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.initScene"),span:1},{default:n(()=>{var r;return[o(k,{type:e(F)((r=d.rowData)==null?void 0:r.initScene)},{default:n(()=>{var c;return[w(y(e(t)(e(te)[(c=d.rowData)==null?void 0:c.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(f,{label:e(t)("page.groupConfig.description"),span:2},{default:n(()=>{var r;return[w(y((r=d.rowData)==null?void 0:r.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Je=B({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(v,{emit:N}){const g=N,d=Y(v,"model");function m(){g("reset")}function f(){g("search")}return(k,S)=>{const _=ee,r=Re,c=Ke;return G(),x(c,{model:d.value,onSearch:f,onReset:m},{default:n(()=>[o(r,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[o(_,{value:d.value.groupName,"onUpdate:value":S[0]||(S[0]=i=>d.value.groupName=i),placeholder:e(t)("page.groupConfig.form.groupName")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ye(v)}const mo=B({name:"group",__name:"index",setup(v){const{hasAuth:N}=$e(),g=Se(),d=X(),{bool:m,setTrue:f}=Ce(!1),{columns:k,columnChecks:S,data:_,getData:r,loading:c,mobilePagination:i,searchParams:R,resetSearchParams:j}=Te({apiFn:Ge,apiParams:{page:1,size:10,groupName:null},columns:()=>[{key:"index",title:t("common.index"),align:"center",width:64},{key:"groupName",title:t("page.groupConfig.groupName"),align:"left",minWidth:260,render:a=>{function l(){d.value=a||null,f()}return o(q,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[a.groupName]})}},{key:"groupStatus",title:t("page.groupConfig.groupStatus"),align:"center",width:80,render:a=>{const l=async(p,b)=>{var D;const h=a.groupStatus===1?0:1,{error:s}=await Me({groupName:a.groupName,groupStatus:h});s||(a.groupStatus=p,(D=window.$message)==null||D.success(t("common.updateSuccess"))),b()};return o(Pe,{value:a.groupStatus,"onUpdate:value":p=>a.groupStatus=p,onFetch:l},null)}},{key:"idGeneratorMode",title:t("page.groupConfig.idGeneratorMode"),align:"center",width:120,render:a=>{if(a.idGeneratorMode===null)return null;const l=t(oe[a.idGeneratorMode]);return o(K,{type:"primary"},W(l)?l:{default:()=>[l]})}},{key:"groupPartition",title:t("page.groupConfig.groupPartition"),align:"center",minWidth:60},{key:"initScene",title:t("page.groupConfig.initScene"),align:"center",minWidth:80,render:a=>{if(a.groupStatus===null)return null;const l=t(te[a.initScene]);return o(K,{type:F(a.initScene)},W(l)?l:{default:()=>[l]})}},{key:"updateDt",title:t("page.groupConfig.updateDt"),align:"left",width:130},{key:"description",title:t("page.groupConfig.description"),align:"left",width:130},{key:"operate",title:t("common.operate"),align:"center",width:130,render:a=>{let l;return N("R_USER")?o(L,null,null):o("div",{class:"flex-center gap-8px"},[o(q,{type:"primary",ghost:!0,size:"small",onClick:()=>C(a.id)},W(l=t("common.edit"))?l:{default:()=>[l]})])}}]}),{drawerVisible:U,operateType:O,editingData:V,handleAdd:E,handleEdit:I,checkedRowKeys:T}=Ue(_,r);function C(a){I(a)}return(a,l)=>{const p=ue,b=je,h=we;return G(),z("div",Qe,[o(Je,{model:e(R),"onUpdate:model":l[0]||(l[0]=s=>$(R)?R.value=s:null),onReset:e(j),onSearch:e(r)},null,8,["model","onReset","onSearch"]),o(h,{title:e(t)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[o(p,{columns:e(S),"onUpdate:columns":l[1]||(l[1]=s=>$(S)?S.value=s:null),"disabled-delete":e(T).length===0,loading:e(c),"show-delete":!1,"show-add":e(N)("R_ADMIN"),onAdd:e(E),onRefresh:e(r)},null,8,["columns","disabled-delete","loading","show-add","onAdd","onRefresh"])]),default:n(()=>[o(b,{"checked-row-keys":e(T),"onUpdate:checkedRowKeys":l[2]||(l[2]=s=>$(T)?T.value=s:null),columns:e(k),data:e(_),"flex-height":!e(g).isMobile,"scroll-x":962,loading:e(c),remote:"","row-key":s=>s.id,pagination:e(i),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(Ye,{visible:e(U),"onUpdate:visible":l[3]||(l[3]=s=>$(U)?U.value=s:null),"operate-type":e(O),"row-data":e(V),onSubmitted:e(r)},null,8,["visible","operate-type","row-data","onSubmitted"]),o(He,{visible:e(m),"onUpdate:visible":l[4]||(l[4]=s=>$(m)?m.value=s:null),"row-data":d.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{mo as default};
