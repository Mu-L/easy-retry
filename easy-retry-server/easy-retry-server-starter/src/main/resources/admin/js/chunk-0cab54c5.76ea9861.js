(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0cab54c5"],{2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("6b75");function i(e){if(Array.isArray(e))return Object(r["a"])(e)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function a(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var o=n("06c5");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return i(e)||a(e)||Object(o["a"])(e)||s()}},7016:function(e,t,n){"use strict";n.r(t);n("7db0"),n("d3b7"),n("ac1f"),n("5319"),n("caad"),n("2532");var r=function(){var e=this,t=e._self._c;return t("div",[t("s-table",{ref:"table",attrs:{size:"default",rowKey:function(e){return e.id},columns:e.notifyColumns,data:e.loadData,alert:e.options.alert,rowSelection:e.options.rowSelection,scroll:{x:2e3}}}),t("a-table",{attrs:{columns:e.notifyColumns,dataSource:e.data,pagination:!1,loading:e.memberLoading,scroll:{x:1200}},scopedSlots:e._u([e._l(["description"],(function(n,r){return{key:n,fn:function(r,i){return[i.editable?t("a-input",{key:n,staticStyle:{margin:"-5px 0"},attrs:{value:r,placeholder:e.notifyColumns.find((function(e){return e.key===n})).title},on:{change:function(t){return e.handleChange(t.target.value,i.key,n)}}}):[e._v(e._s(r))]]}}})),{key:"notifyAttribute",fn:function(n,r){return[r.editable?t("a-textarea",{staticStyle:{margin:"-5px 0"},attrs:{value:e.parseJson(n,r),"auto-size":"",placeholder:e.notifyColumns.find((function(e){return"notifyAttribute"===e.key})).title},on:{click:function(t){return e.handleBlur(r)}}}):[t("span",{domProps:{innerHTML:e._s(e.parseJson(n,r).replaceAll("\r\n","</br>"))}})]]}},{key:"notifyScene",fn:function(n,r){return[r.editable?t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"通知场景",value:n},on:{change:function(t){return e.handleChange(t,r.key,"notifyScene")}}},e._l(e.notifyScene,(function(n,r){return t("a-select-option",{key:r,attrs:{value:r}},[e._v(e._s(n))])})),1):[e._v(e._s(e.notifyScene[n]))]]}},{key:"notifyType",fn:function(n,r){return[r.editable?t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"通知类型",value:n},on:{change:function(t){return e.handleChange(t,r.key,"notifyType")}}},e._l(e.notifyType,(function(n,r){return t("a-select-option",{key:r,attrs:{value:r}},[e._v(e._s(n))])})),1):[e._v(e._s(e.notifyType[n]))]]}},{key:"notifyThreshold",fn:function(n,r){return[r.editable?t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:999999,value:n,disabled:e.notifyThresholdDisabled.includes(e.data.find((function(e){return e.key===r.key})).notifyScene),placeholder:"通知阈值"},on:{change:function(t){return e.handleChange(t,r.key,"notifyThreshold")}}}):[e._v(e._s(n))]]}},{key:"operation",fn:function(n,r){return[r.editable?[r.isNew?t("span",[t("a",{on:{click:function(t){return e.saveRow(r)}}},[e._v("添加")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(t){return e.remove(r.key)}}},[t("a",[e._v("删除")])])],1):t("span",[t("a",{on:{click:function(t){return e.saveRow(r)}}},[e._v("保存")]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{on:{click:function(t){return e.cancel(r.key)}}},[e._v("取消")])],1)]:t("span",[t("a",{on:{click:function(t){return e.toggle(r.key)}}},[e._v("编辑")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(t){return e.remove(r.key)}}},[t("a",[e._v("删除")])])],1)]}}],null,!0)}),t("a-modal",{attrs:{visible:e.visible,title:"添加配置",width:"1000px"},on:{ok:e.handleOk,cancel:e.handlerCancel}},[t("a-form",e._b({attrs:{form:e.form,"body-style":{padding:"0px 0px"}},on:{submit:e.handleSubmit}},"a-form",e.formItemLayout,!1),["1"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"钉钉URL"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["dingDingUrl",{rules:[{required:!0,message:"请输入钉钉URL",whitespace:!0}]}],expression:"[\n            'dingDingUrl',\n            {rules: [{ required: true, message: '请输入钉钉URL', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入钉钉URL"}})],1):e._e(),"4"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"飞书URL"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["larkUrl",{rules:[{required:!0,message:"请输入飞书URL",whitespace:!0}]}],expression:"[\n            'larkUrl',\n            {rules: [{ required: true, message: '请输入飞书URL', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入飞书URL"}})],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"用户名"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user",{rules:[{required:!0,message:"请输入用户名",whitespace:!0}]}],expression:"[\n            'user',\n            {rules: [{ required: true, message: '请输入用户名', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入用户名"}}):e._e()],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"密码"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["pass",{rules:[{required:!0,message:"请输入密码",whitespace:!0}]}],expression:"[\n            'pass',\n            {rules: [{ required: true, message: '请输入密码', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入密码"}}):e._e()],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"SMTP地址"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["host",{rules:[{required:!0,message:"请输入邮件服务器的SMTP地址",whitespace:!0}]}],expression:"[\n            'host',\n            {rules: [{ required: true, message: '请输入邮件服务器的SMTP地址', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入邮件服务器的SMTP地址"}}):e._e()],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"SMTP端口"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{rules:[{required:!0,message:"请输入邮件服务器的SMTP端口",whitespace:!0}]}],expression:"[\n            'port',\n            {rules: [{ required: true, message: '请输入邮件服务器的SMTP端口', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入邮件服务器的SMTP端口"}}):e._e()],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"发件人"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["from",{rules:[{required:!0,message:"请输入发件人",whitespace:!0}]}],expression:"[\n            'from',\n            {rules: [{ required: true, message: '请输入发件人', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入发件人"}}):e._e()],1):e._e(),"2"===this.notifyTypeValue?t("a-form-item",{attrs:{label:"收件人"}},["2"===this.notifyTypeValue?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["tos",{rules:[{required:!0,message:"请输入收件人",whitespace:!0}]}],expression:"[\n            'tos',\n            {rules: [{ required: true, message: '请输入收件人', whitespace: true}]}\n          ]"}],attrs:{placeholder:"请输入收件人"}}):e._e()],1):e._e(),t("a-form-item",{attrs:{"wrapper-col":{xs:{span:24,offset:0},sm:{span:16,offset:8},lg:{span:7}}}})],1)],1)],1)},i=[],a=n("2909"),o=n("5530"),s=(n("d81d"),n("a4d3"),n("e01a"),n("25f0"),n("b64b"),n("4de4"),n("159b"),n("0fea")),l=n("88bc"),u=n.n(l),c=n("2af9"),f={name:"NotifyList",components:{STable:c["j"]},data:function(){var e=this;return{notifyColumns:[{title:"通知类型",dataIndex:"notifyType",key:"notifyType",width:"12%",scopedSlots:{customRender:"notifyType"}},{title:"通知场景",dataIndex:"notifyScene",key:"notifyScene",width:"20%",scopedSlots:{customRender:"notifyScene"}},{title:"通知阈值",dataIndex:"notifyThreshold",key:"notifyThreshold",width:"12%",scopedSlots:{customRender:"notifyThreshold"}},{title:"配置属性",dataIndex:"notifyAttribute",key:"notifyAttribute",width:"30%",scopedSlots:{customRender:"notifyAttribute"}},{title:"描述",dataIndex:"description",key:"description",width:"15%",scopedSlots:{customRender:"description"}},{title:"操作",key:"action",fixed:"right",scopedSlots:{customRender:"operation"}}],data:[],formData:[],loading:!1,form:this.$form.createForm(this),formItemLayout:{labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}},loadData:function(t){return Object(s["m"])(Object.assign(t,e.queryParam)).then((function(e){return e}))},selectedRowKeys:[],selectedRows:[],options:{alert:{show:!0,clear:function(){e.selectedRowKeys=[]}},rowSelection:{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}},optionAlertShow:!1,memberLoading:!1,notifyScene:{1:"重试数量超过阈值",2:"重试失败数量超过阈值",3:"客户端上报失败",4:"客户端组件异常"},notifyType:{1:"钉钉通知",2:"邮箱通知",4:"飞书"},notifyThresholdDisabled:["3","4"],visible:!1,key:"",notifyTypeValue:"1"}},created:function(){var e=this.$route.query.groupName;e&&this.getNotifyConfigList(e)},methods:{reset:function(){this.formData=[],this.data=[];var e=this.$route.query.groupName;e&&this.getNotifyConfigList(e)},getNotifyConfigList:function(e){var t=this;Object(s["m"])({groupName:e}).then((function(e){e.data.map((function(e){var n=e.id,r=e.notifyType,i=e.notifyThreshold,a=e.notifyScene,o=e.description,s=e.notifyAttribute;t.data.push({key:n,id:n,notifyType:r.toString(),notifyThreshold:i,notifyScene:a.toString(),description:o,notifyAttribute:JSON.parse(s),editable:!1,isNew:!1})}))}))},remove:function(e){var t=this.data.find((function(t){return e===t.key})),n=t.id,r=t.key,i=t.notifyType,a=t.notifyThreshold,o=t.notifyAttribute,s=t.notifyScene,l=t.description;this.formData.push({key:r,id:n,notifyType:i,notifyThreshold:a,notifyScene:s,notifyAttribute:JSON.stringify(o),description:l,isDeleted:1});var u=this.data.filter((function(e){return e.key!==r}));this.data=u},saveRow:function(e){var t=this;this.memberLoading=!0;var n=e.id,r=e.key,i=e.notifyType,a=e.notifyThreshold,o=e.notifyAttribute,s=e.notifyScene,l=e.description;if(!i||!s||!o||!l||!this.notifyThresholdDisabled.includes(s)&&!a)return this.memberLoading=!1,void this.$message.error("请填写完整成员信息。");var u=this.formData.find((function(e){return r===e.key}));u||this.formData.push({key:r,id:n,notifyType:i,notifyThreshold:a,notifyScene:s,notifyAttribute:JSON.stringify(o),description:l,isDeleted:0}),new Promise((function(e){setTimeout((function(){e({loop:!1})}),100)})).then((function(){var e=t.data.find((function(e){return e.key===r}));e.editable=!1,e.isNew=!1,t.memberLoading=!1,t.$message.warning("请点击右下角提交按钮以保存所有页面数据")}))},toggle:function(e){var t=this.data.find((function(t){return t.key===e}));t._originalData=Object(o["a"])({},t),t.editable=!t.editable},getRowByKey:function(e,t){var n=this.data;return(t||n).find((function(t){return t.key===e}))},cancel:function(e){var t=this.data.find((function(t){return t.key===e}));Object.keys(t).forEach((function(e){t[e]=t._originalData[e]})),t._originalData=void 0},handleChange:function(e,t,n){var r=Object(a["a"])(this.data),i=r.find((function(e){return t===e.key}));i&&(i[n]=e,this.data=r)},handleBlur:function(e){var t=this;this.key=e.key,this.notifyTypeValue=e.notifyType,new Promise((function(e){setTimeout(e,1500)})).then((function(){var n=t.form,r=u()(e.notifyAttribute,["dingDingUrl","larkUrl","user","pass","host","port","from","tos"]);n.setFieldsValue(r)})),this.visible=!this.visible},handleOk:function(){var e=this;this.form.validateFields((function(t,n){t||(e.handleChange(n,e.key,"notifyAttribute"),e.visible=!1,e.key="")}))},handleSubmit:function(e){e.preventDefault()},handlerCancel:function(){this.visible=!1},parseJson:function(e,t){if(!e)return null;var n="用户名:"+e["user"]+";\r\n密码:"+e["pass"]+";\r\nSMTP地址:"+e["host"]+";\r\nSMTP端口:"+e["port"]+";\r\n发件人:"+e["from"]+";\r\n收件人:"+e["tos"]+";";return"1"===t.notifyType?n="钉钉地址:"+e["dingDingUrl"]+";":"4"===t.notifyType&&(n="飞书地址:"+e["larkUrl"]+";"),n},newMember:function(){var e=this.data.length;this.data.push({key:0===e?"1":(parseInt(this.data[e-1].key)+1).toString(),notifyType:"1",notifyScene:"1",notifyThreshold:null,notifyAttribute:"",description:"",editable:!0,isNew:!0});var t=this.form;t.resetFields()}}},d=f,y=n("2877"),h=Object(y["a"])(d,r,i,!1,null,"ebd5ec14",null);t["default"]=h.exports},"88bc":function(e,t,n){(function(t){var n=1/0,r=9007199254740991,i="[object Arguments]",a="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",l="object"==typeof t&&t&&t.Object===Object&&t,u="object"==typeof self&&self&&self.Object===Object&&self,c=l||u||Function("return this")();function f(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function d(e,t){var n=-1,r=e?e.length:0,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}function y(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}var h=Object.prototype,p=h.hasOwnProperty,m=h.toString,b=c.Symbol,v=h.propertyIsEnumerable,g=b?b.isConcatSpreadable:void 0,w=Math.max;function T(e,t,n,r,i){var a=-1,o=e.length;n||(n=x),i||(i=[]);while(++a<o){var s=e[a];t>0&&n(s)?t>1?T(s,t-1,n,r,i):y(i,s):r||(i[i.length]=s)}return i}function k(e,t){return e=Object(e),S(e,t,(function(t,n){return n in e}))}function S(e,t,n){var r=-1,i=t.length,a={};while(++r<i){var o=t[r],s=e[o];n(s,o)&&(a[o]=s)}return a}function _(e,t){return t=w(void 0===t?e.length-1:t,0),function(){var n=arguments,r=-1,i=w(n.length-t,0),a=Array(i);while(++r<i)a[r]=n[t+r];r=-1;var o=Array(t+1);while(++r<t)o[r]=n[r];return o[t]=a,f(e,this,o)}}function x(e){return R(e)||A(e)||!!(g&&e&&e[g])}function j(e){if("string"==typeof e||V(e))return e;var t=e+"";return"0"==t&&1/e==-n?"-0":t}function A(e){return C(e)&&p.call(e,"callee")&&(!v.call(e,"callee")||m.call(e)==i)}var R=Array.isArray;function N(e){return null!=e&&D(e.length)&&!O(e)}function C(e){return q(e)&&N(e)}function O(e){var t=L(e)?m.call(e):"";return t==a||t==o}function D(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function L(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function q(e){return!!e&&"object"==typeof e}function V(e){return"symbol"==typeof e||q(e)&&m.call(e)==s}var U=_((function(e,t){return null==e?{}:k(e,d(T(t,1),j))}));e.exports=U}).call(this,n("c8ba"))}}]);